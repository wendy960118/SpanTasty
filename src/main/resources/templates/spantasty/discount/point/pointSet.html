<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .tooltip-inner {

            width: 1000px;     /* å›ºå®šå¯¬åº¦ */
        }
    </style>
</head>
<body>
<div th:replace="~{spantasty//display/navbar}"></div>
<div class="content">
<form th:action="@{/point/pointSet/post}" th:method="PUT" enctype="multipart/form-data">
    <div class="container ">
        <h1 class="mb-4 mt-3"><i class="fa-solid fa-p me-3" style="color: #FFD43B;"></i></i>é»æ•¸è¨­å®š</h1>
            <nav class="mb-3">
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">ä¸€èˆ¬è¨­å®š</button>
                <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">é€²éšè¨­å®š</button>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <!-- ä¸€èˆ¬è¨­å®š -->
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0">
                    <!-- card -->
                    <div class="card mb-3">
                        <div class="card-header ">
                            æ¶ˆè²»é»æ•¸
                        </div>
                        <div class="card-body">
                        <blockquote class="blockquote mb-0">
                            <p>è³¼å®¢åœ¨æ¯æ¬¡è³¼ç‰©å¾Œï¼Œè©²ç­†è¨‚å–®çš„ç‹€æ…‹è½‰ç‚ºã€Œå·²å®Œæˆã€æ™‚ç²å¾—çš„é»æ•¸ã€‚</p>
                        </blockquote>
                        </div>
                    </div>
                    <!-- card -->
                    <div class="card mb-3">
                        <div class="card-header">
                        é›†é»æ›ç®—
                        </div>
                        <div class="card-body">
                        <blockquote class="blockquote mb-0">
                            <span></span>
                            <div class="input-group mb-3 ">
                                <div class="row align-items-center">
                                    <div class="col-auto"><label>æ¯</label></div>
                                    <div class="col-auto ">
                                        <div class="input-group ">
                                            <span class="input-group-text">NT$</span>
                                            <input type="number" name="amountPerPoint" class="form-control" th:value="${pointSet.amountPerPoint}">
                                        </div>
                                    </div>
                                    <div class="col-auto"><label>ç´¯ç©</label></div>
                                    <div class="col-auto"><input type="number" name="pointsEarned" class="form-control" th:value="${pointSet.pointsEarned}"></div>
                                    <div class="col-auto"><label>é»</label></div>
                                </div>
                            </div>
                            <footer class="blockquote-footer pt-2"><cite title="Source Title">1 é»ç´…åˆ©é»æ•¸å¯æŠ˜æŠµNT$1å…ƒ</cite></footer>
                        </blockquote>
                        </div>
                    </div>
                </div>
            
                <!-- é€²éšè¨­å®š -->
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="0">
                    <!-- card -->
                    <div class="card mb-3">
                        <div class="card-header">
                        æœƒå“¡ç”Ÿæ—¥é»æ•¸
                        </div>
                        <div class="card-body">
                        <blockquote class="blockquote mb-0">
                            <span></span>
                            <div class="input-group mb-3 ">
                                <div class="row align-items-center">
                                    <div class="col-auto"><label>æ–¼æœƒå“¡ç”Ÿæ—¥</label></div>
                                    <div class="col-auto ">
                                        <select class="form-select" name="birthType" th:value="${pointSet.birthType}">
                                            <option value="ç•¶æœˆ" th:selected="${pointSet.birthType == 'ç•¶æœˆ'}">ç•¶æœˆ</option>
                                            <option value="ç•¶æ—¥" th:selected="${pointSet.birthType == 'ç•¶æ—¥'}">ç•¶æ—¥</option>
                                        </select>
                                    </div>
                                    <div class="col-auto"><label>ï¼Œç´…åˆ©é»æ•¸ç´¯ç©</label></div>
                                    <div class="col-auto"><input type="number" name="pointRatio" class="form-control" th:value="${pointSet.pointRatio}"></div>
                                    <div class="col-auto"><label>å€ã€‚</label></div>
                                </div>
                            </div>
                        </blockquote>
                        </div>
                    </div>
                    <!-- card -->
                    <div class="card mb-3">
                        <div class="card-header">
                            é»æ•¸åˆ°æœŸæ—¥
                        </div>
                        <div class="card-body">
                        <blockquote class="blockquote mb-0">
                            <p>åœ¨ä¸€å¹´å…§ç™¼æ”¾çš„é»æ•¸æœƒçµ±ä¸€åœ¨æ˜å¹´çš„æŒ‡å®šæ—¥åˆ°æœŸã€‚ä¾‹å¦‚ï¼šè‹¥è¨­å®šåˆ°æœŸæ—¥ç‚º6/30ï¼Œå‰‡ç•¶å¹´åº¦1/1è‡³12/31ç™¼æ”¾çš„é»æ•¸ï¼Œæœƒçµ±ä¸€åœ¨æ˜å¹´çš„6/30åˆ°æœŸã€‚</p>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="isExpiry" value="noExpiry" th:checked="${pointSet.isExpiry == 'noExpiry'}" id="flexRadioDefault1">
                                <label class="form-check-label" for="flexRadioDefault1">
                                  æ°¸ä¸åˆ°æœŸ
                                </label>
                            </div>
                            <div class="row pt-3 align-items-center">
                                <div class="col-auto">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="isExpiry" value="isExpiry" th:checked="${pointSet.isExpiry == 'isExpiry'}" id="flexRadioDefault2">
                                        <label class="form-check-label" for="flexRadioDefault2">
                                          æŒ‡å®šåˆ°æœŸæ—¥
                                        </label>
                                    </div>
                                </div>
                                <div class="col-auto align-items-center">
                                    <select class="form-select" id="month" name="expiryMonth" th:value="${pointSet.expiryMonth}">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                </div>
                                <div class="col-auto">æœˆ</div>
                                <div class="col-auto">
                                    <select class="form-select" id="day" name="expiryDay" th:value="${pointSet.expiryDay}">
                                    </select>
                                </div>
                                <div class="col-auto">æ—¥</div>
                                
                            </div>
                        </blockquote>
                        </div>
                    </div>
                    <!-- card -->
                    <div class="card mb-3">
                        <div class="card-header">
                            é»æ•¸è¦å‰‡èªªæ˜
                        </div>
                        <div class="card-body">
                        <blockquote class="blockquote mb-0">
                            <div class="d-flex justify-content-between">
                                <span>å¯«ä¸‹ä½ çš„é»æ•¸ä½¿ç”¨èªªæ˜ã€é›†é»èªªæ˜é›†æ¢æ¬¾ï¼Œå°‡æ–¼é»æ•¸ä¸­å¿ƒå±•ç¤ºã€‚</span>
                                <button type="button" class="btn btn-outline-primary" id="preview">é è¦½</button>
                            </div>
                            <div class="border p-3 mt-3">
                                <p>é»æ“Šä¸‹æ–¹æ¨™ç±¤å¯å¿«é€Ÿæ’å…¥ç³»çµ±è®Šæ•¸ï¼Œå°‡è‡ªå‹•å¸¶å…¥å°æ‡‰çš„è¨­å®šå€¼ã€‚<span class="ms-3 text-primary " data-bs-html="true" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="ã€ç¯„ä¾‹ã€‘<br>
                                    æ¯é€±é ˜ {AMOUNT} å…ƒå³å¯ç´¯ç© {POINT} é»<br>
                                    å¯¦éš›é¡¯ç¤ºï¼šæ¯é€±é ˜ $10 å…ƒå³å¯ç´¯ç© 1 é»">æŸ¥çœ‹ç¯„ä¾‹<i class="fa-regular fa-circle-question ms-1 text-primary"></i></span></p>
                                <div class="">
                                    <button type="button" class="btn btn-warning btn-sm tag-btn" data-value="{AMOUNT}">é»æ•¸é‡‘é¡ {AMOUNT}</button>
                                    <button type="button" class="btn btn-warning btn-sm tag-btn" data-value="{POINT}">é»æ•¸å›é¥‹ {POINT}</button>
                                    <button type="button" class="btn btn-success btn-sm tag-btn" data-value="{EXPIRE_DATE}">åˆ°æœŸæ—¥ {EXPIRE_DATE}</button>
                                    <button type="button" class="btn btn-info btn-sm tag-btn" data-value="{BIRTH_PERIOD}">ç”Ÿæ—¥æœŸé–“ {BIRTH_PERIOD}</button>
                                    <button type="button" class="btn btn-info btn-sm tag-btn" data-value="{MULTIPLY_POINT}">ç”Ÿæ—¥å€æ•¸ {MULTIPLY_POINT}</button>
                                    <button type="button" class="btn btn-secondary btn-sm tag-btn" data-value="{br}">æ›è¡Œ {br}</button>
                                </div>
                            </div>
                            <div class="form-floating mt-2">
                                <textarea name="setDescription" th:text="${pointSet.setDescription}" class="form-control" placeholder="Leave a comment here" id="pointTextArea" style="height: 250px"></textarea>
                            </div>
                            <i class="fa-regular fa-note-sticky ms-1 me-1" id="demo"></i>
                        </blockquote>
                        </div>
                    </div>
                </div>
                <!-- ä¿®æ”¹btn -->
                <div class="d-flex justify-content-center">
                    <button type="button" class="btn btn-outline-secondary me-3" onclick="window.location.href='/SpanTasty/point/pointCenter'">è¿”å›</button>
                    <button id="submit" type="submit" class="btn btn-outline-primary me-3">ä¿®æ”¹</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">é»æ•¸å…¬å‘Šé è¦½</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="previewDiv">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>


    <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM fully loaded and parsed");

    let monthIndex = [[${pointSet.expiryMonth}]];
    let dayIndex = [[${pointSet.expiryDay}]];
    console.log("Initial monthIndex:", monthIndex);
    console.log("Initial dayIndex:", dayIndex);

    const selectMonth = document.getElementById("month");
    const selectDay = document.getElementById("day");

    if (!selectMonth || !selectDay) {
        console.error("Month or Day select element not found!");
        return;
    }

    function updateDayOption() {
        console.log("Updating day options for month:", monthIndex);

        const daysInMonth = new Date(new Date().getFullYear(), monthIndex, 0).getDate();
        console.log("Days in selected month:", daysInMonth);

        selectDay.innerHTML = "";
        for(let i = 1; i <= daysInMonth; i++) {
            let dayOption = document.createElement('option');
            dayOption.value = i;
            dayOption.textContent = i;
            selectDay.appendChild(dayOption);
        }

        if(dayIndex > daysInMonth) {
            dayIndex = daysInMonth;
        }
        selectDay.value = dayIndex;
        console.log("Set day value to:", dayIndex);
    }

    // é»æ“Šmonthé¸å–®
    selectMonth.addEventListener('change', function(event) {
        monthIndex = parseInt(event.target.value);
        console.log("Month changed to:", monthIndex);
        updateDayOption();
    });
    
    // é»æ“Šdayé¸å–®
    selectDay.addEventListener('change', function(event) {
        dayIndex = parseInt(event.target.value);
        console.log("Day changed to:", dayIndex);
    });

    // åˆå§‹åŒ–
    console.log("Setting initial month value:", monthIndex);
    selectMonth.value = monthIndex;
    updateDayOption();

    // æª¢æŸ¥åˆå§‹åŒ–å¾Œçš„å€¼
    console.log("After initialization - Month value:", selectMonth.value);
    console.log("After initialization - Day value:", selectDay.value);

    document.getElementById('submit').addEventListener('click', function(event) {
        let numbers = document.querySelectorAll('.number');
        let check = true;
        for (let i = 0; i < numbers.length; i++) {
            if (!/^\d+$/.test(numbers[i].value)) {
                check = false;
                break;
            }
        }
        if(check) {
            alert("ä¿®æ”¹æˆåŠŸ!");
        } else {
            alert("æ ¼å¼æœ‰èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥!");
            event.preventDefault();
        }
    });
});

document.addEventListener("DOMContentLoaded", function() {
     showSidebar('points');


     //é»æ•¸èªªæ˜
    let cursorPosition = 0;
    const pointTextArea = document.getElementById('pointTextArea')
    pointTextArea.addEventListener('click',function(){
        cursorPosition=this.selectionStart
    })
    pointTextArea.addEventListener('keyup',function(){
        cursorPosition=this.selectionStart
    })

    document.querySelectorAll('.tag-btn').forEach(tag => {
        tag.addEventListener('click',function(){
            const tagValue = this.getAttribute('data-value')
            const content = pointTextArea.value

            const newConent = content.slice(0,cursorPosition)+tagValue+content.slice(cursorPosition)
            pointTextArea.value = newConent

            const newPosition = cursorPosition + tagValue.length;
            pointTextArea.setSelectionRange(newPosition,newPosition)

            pointTextArea.focus
        })
    });
});


document.getElementById('preview').addEventListener('click',function(e){
    e.preventDefault()
    axios.get('/SpanTasty/point/pointSet/preview',{
        params:{
            pointText:document.getElementById('pointTextArea').value
        }
    })
    .then(res=>{
        document.getElementById('previewDiv').innerHTML=res.data
        var myModal = new bootstrap.Modal(document.getElementById('exampleModal'));
        myModal.show();
    })
})

//demo
document.getElementById('demo').addEventListener('click',function(){
    document.getElementById('pointTextArea').value = 
    "ğŸæ–°æœƒå“¡å°ˆå±¬å¥½ç¦®ğŸ{br}\n" +
    "é¦–æ¬¡è¨»å†Šè¼¸å…¥å°ˆå±¬å„ªæƒ ç¢¼ WELCOME ï¼Œç«‹å³é ˜å–å„ªæƒ åˆ¸ï¼Œå–®ç­†æœ€é«˜æŠ˜æ‰£10% !{br}\n" +
    "{br}\n"+
    "{br}\n"+
    "ğŸ’°é»æ•¸ç´¯ç©è¦å‰‡ğŸ’°{br}\n" +
    "ğŸ”¸æ¶ˆè²»æ¯æ»¿ 100 å…ƒ = ç²å¾— 2 é»{br}\n" +
    "ğŸ”¸é»æ•¸æœ‰æ•ˆæœŸé™è‡³éš”å¹´ 12/31{br}\n" +
    "ğŸ”¸ç”Ÿæ—¥ç•¶æœˆæ¶ˆè²»äº«é»æ•¸ 2 å€å›é¥‹{br}";
})


const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

    </script>      
</body>
</html>